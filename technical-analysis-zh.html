<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊäÄÊúØÂàÜÊûê‰ª™Ë°®Áõò - ‰∏≠ÂõΩÁßëÊäÄËÇ°</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        :root {
            --tencent-color: #0052D4;
            --baidu-color: #2932E1;
            --jd-color: #E31837;
            --alibaba-color: #FF6A00;
            --xiaomi-color: #FF6700;
            --meituan-color: #FFD100;
            --primary-dark: #1a1a2e;
            --secondary-dark: #16213e;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.15);
        }

        * {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.35);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-dark) 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .content-wrapper {
            padding: 30px;
        }

        .last-updated {
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        /* Technical Rating Cards */
        .tech-rating-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .tech-rating-card {
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .tech-rating-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
        }

        .tech-rating-card.tencent::before { background: var(--tencent-color); }
        .tech-rating-card.baidu::before { background: var(--baidu-color); }
        .tech-rating-card.jd::before { background: var(--jd-color); }
        .tech-rating-card.alibaba::before { background: var(--alibaba-color); }
        .tech-rating-card.xiaomi::before { background: var(--xiaomi-color); }
        .tech-rating-card.meituan::before { background: var(--meituan-color); }

        .tech-rating-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-3px);
        }

        .tech-rating-card .company-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 15px;
        }

        .tech-rating-card .rating-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }

        .rating-strong-buy { background: #00C853; color: white; }
        .rating-buy { background: #4CAF50; color: white; }
        .rating-hold { background: #FF9800; color: white; }
        .rating-sell { background: #F44336; color: white; }
        .rating-strong-sell { background: #D32F2F; color: white; }

        .tech-metric {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.9rem;
        }

        .tech-metric:last-child {
            border-bottom: none;
        }

        .tech-metric .label {
            color: #666;
        }

        .tech-metric .value {
            font-weight: 600;
            color: var(--primary-dark);
        }

        .tech-metric .value.bullish { color: #00C853; }
        .tech-metric .value.bearish { color: #F44336; }
        .tech-metric .value.neutral { color: #FF9800; }

        /* Indicator Tables */
        .indicator-table {
            width: 100%;
            margin-bottom: 20px;
        }

        .indicator-table th {
            background: var(--primary-dark);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .indicator-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e9ecef;
        }

        .indicator-table tr:hover {
            background: #f8f9fa;
        }

        /* Gauge bars */
        .gauge-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .gauge-bar {
            flex: 1;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .gauge-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .gauge-fill.bullish { background: linear-gradient(90deg, #4CAF50, #00C853); }
        .gauge-fill.bearish { background: linear-gradient(90deg, #F44336, #D32F2F); }
        .gauge-fill.neutral { background: linear-gradient(90deg, #FF9800, #FFC107); }

        /* Signals List */
        .signals-list {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }

        .signals-list li {
            padding: 8px 12px;
            margin-bottom: 6px;
            border-radius: 6px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .signals-list li.bullish {
            background: #E8F5E9;
            color: #2E7D32;
        }

        .signals-list li.bearish {
            background: #FFEBEE;
            color: #C62828;
        }

        .signals-list li.neutral {
            background: #FFF3E0;
            color: #EF6C00;
        }

        /* Derivative Analysis Box */
        .derivative-box {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .derivative-box h3 {
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .derivative-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .derivative-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
        }

        .derivative-item .label {
            font-size: 0.85rem;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .derivative-item .value {
            font-size: 1.3rem;
            font-weight: 700;
        }

        /* Expert Commentary */
        .expert-commentary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-dark);
        }

        .expert-commentary h4 {
            color: var(--primary-dark);
            margin-bottom: 15px;
        }

        .expert-commentary p {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        /* Back Button */
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            color: white;
            text-decoration: none;
            border-radius: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: white;
            color: var(--primary-dark);
        }
    </style>
</head>
<body>
    <div class="container main-container">
        <header>
            <a href="equity-analysis-zh.html" class="back-btn">‚Üê ËøîÂõûÊÄªËßà</a>
            <h1>üìà ÊäÄÊúØÂàÜÊûê‰ª™Ë°®Áõò</h1>
            <p>ÂÆûÊó∂ÊäÄÊúØÊåáÊ†á‰∏éË°çÁîüÂìÅ‰∫§ÊòìÂàÜÊûê</p>
        </header>

        <div class="content-wrapper">
            <div class="last-updated" id="lastUpdated">
                üìÖ Ê≠£Âú®Âä†ËΩΩÊï∞ÊçÆ...
            </div>

            <!-- Technical Rating Cards -->
            <h3 style="color: var(--primary-dark); margin-bottom: 20px;">üéØ ÊäÄÊúØËØÑÁ∫ß</h3>
            <div class="tech-rating-grid" id="techRatingsGrid">
                <!-- Cards will be inserted here by JavaScript -->
            </div>

            <!-- Technical Indicators Comparison -->
            <h3 style="color: var(--primary-dark); margin: 30px 0 20px;">üìä ÊäÄÊúØÊåáÊ†áÂØπÊØî</h3>
            <div class="row">
                <div class="col-md-6">
                    <div class="chart-container" style="height: 350px; background: white; padding: 20px; border-radius: 10px; box-shadow: var(--shadow-sm);">
                        <canvas id="rsiChart"></canvas>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-container" style="height: 350px; background: white; padding: 20px; border-radius: 10px; box-shadow: var(--shadow-sm);">
                        <canvas id="macdChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="chart-container" style="height: 350px; background: white; padding: 20px; border-radius: 10px; box-shadow: var(--shadow-sm);">
                        <canvas id="volatilityChart"></canvas>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-container" style="height: 350px; background: white; padding: 20px; border-radius: 10px; box-shadow: var(--shadow-sm);">
                        <canvas id="stochasticChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Detailed Company Analysis -->
            <h3 style="color: var(--primary-dark); margin: 30px 0 20px;">üîç Detailed Analysis</h3>
            <div id="detailedAnalysis">
                <!-- Detailed sections will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        const STOCK_CONFIG = {
            'tencent': { name: 'Tencent', symbol: '00700', color: '#0052D4' },
            'baidu': { name: 'Baidu', symbol: '09888', color: '#2932E1' },
            'jd': { name: 'JD.com', symbol: '09618', color: '#E31837' },
            'alibaba': { name: 'Alibaba', symbol: '09988', color: '#FF6A00' },
            'xiaomi': { name: 'Xiaomi', symbol: '01810', color: '#FF6700' },
            'meituan': { name: 'Meituan', symbol: '03690', color: '#FFD100' }
        };

        let stockData = {};

        // Fetch stock data from JSON
        async function loadStockData() {
            try {
                const response = await fetch('data/stock_summary.json');
                const data = await response.json();

                // Also load comprehensive data for more details
                const compResponse = await fetch('data/comprehensive_stock_data.json');
                const compData = await compResponse.json();

                // Merge data
                for (let company in data) {
                    stockData[company] = {
                        ...data[company],
                        ...compData.companies[company]
                    };
                }

                updateDashboard();
            } catch (error) {
                console.error('Error loading stock data:', error);
                document.getElementById('lastUpdated').textContent = '‚ö†Ô∏è Error loading data';
            }
        }

        function updateDashboard() {
            updateLastUpdated();
            renderTechRatings();
            renderCharts();
            renderDetailedAnalysis();
        }

        function updateLastUpdated() {
            const now = new Date();
            const timestamp = now.toLocaleString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('lastUpdated').innerHTML = `üìÖ Last Updated: ${timestamp}`;
        }

        function renderTechRatings() {
            const grid = document.getElementById('techRatingsGrid');
            grid.innerHTML = '';

            for (let [key, config] of Object.entries(STOCK_CONFIG)) {
                const data = stockData[key];
                if (!data) continue;

                const ratingClass = data.technical_rating?.rating?.toLowerCase().replace(/ /g, '-') || 'hold';
                const rsi = data.rsi || 50;
                const volatility = data.volatility || 30;

                let rsiClass = 'neutral';
                if (rsi < 30) rsiClass = 'bullish';
                else if (rsi > 70) rsiClass = 'bearish';

                let volClass = 'neutral';
                if (volatility < 25) volClass = 'bullish';
                else if (volatility > 40) volClass = 'bearish';

                const card = document.createElement('div');
                card.className = `tech-rating-card ${key}`;
                card.innerHTML = `
                    <div class="company-name">${config.name} (${config.symbol})</div>
                    <div class="rating-badge rating-${ratingClass}">${data.technical_rating?.rating || 'HOLD'}</div>
                    <div class="tech-metric">
                        <span class="label">Price</span>
                        <span class="value">HK$${data.price?.toFixed(2) || 'N/A'}</span>
                    </div>
                    <div class="tech-metric">
                        <span class="label">Change</span>
                        <span class="value ${data.change_pct >= 0 ? 'bullish' : 'bearish'}">
                            ${data.change_pct >= 0 ? '+' : ''}${data.change_pct?.toFixed(2) || 0}%
                        </span>
                    </div>
                    <div class="tech-metric">
                        <span class="label">RSI(14)</span>
                        <span class="value ${rsiClass}">${rsi.toFixed(1)}</span>
                    </div>
                    <div class="tech-metric">
                        <span class="label">Volatility</span>
                        <span class="value ${volClass}">${volatility.toFixed(1)}%</span>
                    </div>
                    <div class="tech-metric">
                        <span class="label">52W Position</span>
                        <span class="value">${data['52w_position']?.toFixed(0) || 50}%</span>
                    </div>
                `;
                grid.appendChild(card);
            }
        }

        function renderCharts() {
            // RSI Chart
            const rsiData = Object.entries(STOCK_CONFIG).map(([key, config]) => ({
                label: config.name,
                value: stockData[key]?.rsi || 50,
                color: config.color
            }));

            new Chart(document.getElementById('rsiChart'), {
                type: 'bar',
                data: {
                    labels: rsiData.map(d => d.label),
                    datasets: [{
                        label: 'RSI (14)',
                        data: rsiData.map(d => d.value),
                        backgroundColor: rsiData.map(d => {
                            if (d.value < 30) return '#00C853';
                            if (d.value > 70) return '#F44336';
                            return '#FF9800';
                        })
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'RSI (14) - Overbought >70, Oversold <30', font: { size: 14, weight: 'bold' } },
                        legend: { display: false }
                    },
                    scales: {
                        y: { min: 0, max: 100 }
                    }
                }
            });

            // MACD Chart
            new Chart(document.getElementById('macdChart'), {
                type: 'bar',
                data: {
                    labels: rsiData.map(d => d.label),
                    datasets: [{
                        label: 'MACD',
                        data: Object.values(STOCK_CONFIG).map((_, i) => stockData[Object.keys(STOCK_CONFIG)[i]]?.macd || 0),
                        backgroundColor: Object.values(STOCK_CONFIG).map((config, i) => {
                            const macd = stockData[Object.keys(STOCK_CONFIG)[i]]?.macd || 0;
                            return macd > 0 ? '#00C853' : '#F44336';
                        })
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'MACD (Positive = Bullish, Negative = Bearish)', font: { size: 14, weight: 'bold' } },
                        legend: { display: false }
                    }
                }
            });

            // Volatility Chart
            new Chart(document.getElementById('volatilityChart'), {
                type: 'line',
                data: {
                    labels: rsiData.map(d => d.label),
                    datasets: [{
                        label: 'Annualized Volatility %',
                        data: Object.values(STOCK_CONFIG).map((_, i) => stockData[Object.keys(STOCK_CONFIG)[i]]?.volatility || 30),
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.2)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Historical Volatility (Annualized)', font: { size: 14, weight: 'bold' } },
                        legend: { display: false }
                    }
                }
            });

            // Stochastic Chart
            new Chart(document.getElementById('stochasticChart'), {
                type: 'bar',
                data: {
                    labels: rsiData.map(d => d.label),
                    datasets: [{
                        label: 'Stochastic %K',
                        data: Object.values(STOCK_CONFIG).map((_, i) => stockData[Object.keys(STOCK_CONFIG)[i]]?.stoch_k || 50),
                        backgroundColor: Object.values(STOCK_CONFIG).map((_, i) => {
                            const stoch = stockData[Object.keys(STOCK_CONFIG)[i]]?.stoch_k || 50;
                            if (stoch < 20) return '#00C853';
                            if (stoch > 80) return '#F44336';
                            return '#FF9800';
                        })
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Stochastic %K (Oversold <20, Overbought >80)', font: { size: 14, weight: 'bold' } },
                        legend: { display: false }
                    },
                    scales: {
                        y: { min: 0, max: 100 }
                    }
                }
            });
        }

        function renderDetailedAnalysis() {
            const container = document.getElementById('detailedAnalysis');
            container.innerHTML = '';

            for (let [key, config] of Object.entries(STOCK_CONFIG)) {
                const data = stockData[key];
                if (!data) continue;

                const techRating = data.technical_rating || {};
                const derivAnalysis = data.derivative_analysis || {};
                const commentary = data.expert_commentary || {};

                const section = document.createElement('div');
                section.className = 'company-section mb-4';
                section.style.cssText = `background: white; padding: 25px; border-radius: 12px; border-left: 5px solid ${config.color}; box-shadow: var(--shadow-sm);`;

                section.innerHTML = `
                    <h4 style="color: ${config.color}; margin-bottom: 20px;">${config.name} (${config.symbol})</h4>

                    <div class="row">
                        <div class="col-md-6">
                            <h6 style="color: var(--primary-dark);">üìà Technical Signals</h6>
                            <ul class="signals-list">
                                ${(techRating.signals || []).map(s => {
                                    const isBullish = s.toLowerCase().includes('bullish') || s.toLowerCase().includes('oversold');
                                    const isBearish = s.toLowerCase().includes('bearish') || s.toLowerCase().includes('overbought');
                                    const cls = isBullish ? 'bullish' : isBearish ? 'bearish' : 'neutral';
                                    const icon = isBullish ? 'üìà' : isBearish ? 'üìâ' : '‚û°Ô∏è';
                                    return `<li class="${cls}">${icon} ${s}</li>`;
                                }).join('')}
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 style="color: var(--primary-dark);">üìä Key Levels</h6>
                            <table class="table table-sm">
                                <tr><td>Support</td><td class="text-success">HK$${(derivAnalysis.support_level || 0).toFixed(2)}</td></tr>
                                <tr><td>Resistance</td><td class="text-danger">HK$${(derivAnalysis.resistance_level || 0).toFixed(2)}</td></tr>
                                <tr><td>52W High</td><td>HK$${(data['52w_high'] || 0).toFixed(2)}</td></tr>
                                <tr><td>52W Low</td><td>HK$${(data['52w_low'] || 0).toFixed(2)}</td></tr>
                            </table>
                        </div>
                    </div>

                    ${commentary.technical ? `
                    <div class="expert-commentary mt-3">
                        <h6>üî¨ ÊäÄÊúØÂàÜÊûê</h6>
                        <p style="margin-bottom: 0;">${commentary.technical}</p>
                    </div>
                    ` : ''}

                    ${commentary.derivative ? `
                    <div class="derivative-box mt-3">
                        <h6>üéØ Ë°çÁîüÂìÅ‰∫§ÊòìÂàÜÊûê</h6>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="derivative-item">
                                    <div class="label">È¢ÑÊúüÊó•Ê≥¢Âä®</div>
                                    <div class="value">HK$${(derivAnalysis.daily_expected_move || 0).toFixed(2)}</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="derivative-item">
                                    <div class="label">ATR %</div>
                                    <div class="value">${(derivAnalysis.atr_percent || 0).toFixed(2)}%</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="derivative-item">
                                    <div class="label">Á¥ßÂáëÊ≠¢Êçü</div>
                                    <div class="value">HK$${(derivAnalysis.tight_stop_loss || 0).toFixed(2)}</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="derivative-item">
                                    <div class="label">ÁõÆÊ†á‰ΩçÔºà2:1Ôºâ</div>
                                    <div class="value">HK$${(derivAnalysis.target_2r || 0).toFixed(2)}</div>
                                </div>
                            </div>
                        </div>
                        <p class="mt-3 mb-0" style="opacity: 0.9;">${commentary.derivative}</p>
                    </div>
                    ` : ''}
                `;

                container.appendChild(section);
            }
        }

        // Load data on page load
        document.addEventListener('DOMContentLoaded', loadStockData);
    </script>
    <script src="language-switcher.js"></script>
</body>
</html>
